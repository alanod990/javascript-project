<!DOCTYPE html>
<html lang="pt-br">
    <head>
        <title>Gry Confecções</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="css/reset.css" rel="stylesheet">
    </head>
    
    <body>
    
    <style>
    header h1 {
        font-family: Georgia, 'Times New Roman', Times, serif;
        font-size: 30px;
        border: 1px solid;
        background-color: grey;
        text-align: center;
    }
    
    nav ul {
        font-family: Georgia, 'Times New Roman', Times, serif;
        display: flex;
        padding: 5px;
        border: 1px solid;
        background-color: lightgrey;
        justify-content: center
    }
    
    nav ul li:not(:last-child)::after {
        content: "•";
        margin: 6px;
    }
    
    /* código fuzzy search */
    
    /* Isso garante que a lista fique presa ao campo de busca */
.busca-container {
    position: relative; 
    width: 300px; /* Largura do campo */
    margin-top: 10px;
}

#buscaPeca {
    width: 100%;
    padding: 8px;
    box-sizing: border-box; /* Garante que o padding não aumente a largura total */
}

/* A lista de sugestões */
.lista-suspensa {
    list-style: none; /* Tira as bolinhas da lista */
    padding: 0;
    margin: 0;
    position: absolute; /* O PULO DO GATO: Faz a lista flutuar por cima de tudo */
    width: 100%;
    background: white;
    border: 1px solid #ccc;
    display: none; /* Começa escondida */
    max-height: 200px; /* Se tiver muitos itens, cria barra de rolagem */
    overflow-y: auto;
    z-index: 10; /* Garante que fique na frente de outros elementos */
}

.lista-suspensa li {
    padding: 10px;
    border-bottom: 1px solid #eee;
    cursor: pointer; /* Mãozinha do mouse */
}

.lista-suspensa li:hover {
    background-color: #f0f0f0; /* Efeito cinza quando passa o mouse */
}

/* Quando o item estiver selecionado pelo teclado */
.item-selecionado {
    background-color: #1e90ff !important; /* Azul DodgerBlue */
    color: white; /* Texto branco */
}
    
    </style>
    <header>
        <div class="titulo">
            <h1>Gry Confecções</h1>
        </div>
    </header>
    <nav>
        <ul>
            <li>Encomendas</li>
            <li>Produção</li>
            <li>Dashboard</li>
        </ul>
    </nav>
    <form>
        <label for="escola">Escola:</label>
        <select id="escola" required>
            <option value="">Selecione...</option>
            <option value="Frei">Frei</option>
            <option value="M. Couto">M. Couto</option>
            <option value="Recanto S.">Recanto S.</option>
            <option value="S. Bernardo">S. Bernardo</option>
            <option value="F. Saber">F. Saber</option>
            <option value="Sonho Meu">Sonho Meu</option>
        </select>
        
        <div class="busca-container">
            <label for="buscaPeca">Peça do Uniforme:</label>
            <input type="text" id="buscaPeca" placeholder="Digite o nome da peça..." autocomplete="off">
            <ul id="listaResultados" class="lista-suspensa"></ul>
        </div>

        
    </form>
    <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2/dist/fuse.min.js"></script>
    <script>
// --- 1. DADOS ---
const pecas = [
    { nome: "Blusa Fundamental", codigo: "BF01" },
    { nome: "Blusa Ed Inf", codigo: "BI01" },
    { nome: "Calça Terbrim", codigo: "CTB" },
    { nome: "Calça Helanca", codigo: "CB" },
    { nome: "Shorts Saia Helanca", codigo: "SSH" },
    { nome: "Short Helanca", codigo: "SH" }
];

// --- 2. CONFIGURAÇÃO DO FUSE ---
const opcoes = {
    keys: ['nome', 'codigo'],
    threshold: 0.4,
};
const fuse = new Fuse(pecas, opcoes);

// --- 3. ELEMENTOS DO DOM ---
const input = document.getElementById('buscaPeca');
const lista = document.getElementById('listaResultados');

// VARIÁVEL DE CONTROLE (NOVO!)
// Ela diz qual item da lista está selecionado (-1 significa nenhum)
let focoAtual = -1;

// --- 4. FUNÇÃO QUE FAZ A BUSCA (INPUT) ---
input.addEventListener('input', function() {
    const valor = input.value;
    
    // Reseta o foco toda vez que digita algo novo
    focoAtual = -1;

    if (!valor) {
        lista.style.display = 'none';
        return;
    }

    const resultados = fuse.search(valor);
    lista.innerHTML = '';

    if (resultados.length > 0) {
        lista.style.display = 'block';
        
        resultados.forEach(function(resultado) {
            const li = document.createElement('li');
            li.textContent = resultado.item.nome;
            
            // Evento de Mouse (Clique)
            li.addEventListener('click', function() {
                input.value = resultado.item.nome;
                lista.style.display = 'none';
            });

            lista.appendChild(li);
        });
    } else {
        lista.style.display = 'none';
    }
});

// --- 5. NAVEGAÇÃO POR TECLADO (CORRIGIDO) ---
input.addEventListener('keydown', function(e) {
    let itens = lista.getElementsByTagName('li');

    // Se a lista estiver escondida, não fazemos nada especial (deixa o navegador agir)
    if (lista.style.display === 'none') return;

    if (e.key === "ArrowDown") { 
        e.preventDefault(); // <--- O SEGREDO! Trava o cursor no lugar
        focoAtual++; 
        addAtivo(itens);
    } 
    else if (e.key === "ArrowUp") { 
        e.preventDefault(); // <--- O SEGREDO! Trava o cursor no lugar
        focoAtual--; 
        addAtivo(itens);
    } 
    else if (e.key === "Enter") { 
        e.preventDefault(); // Evita enviar o formulário
        if (focoAtual > -1) {
            if (itens) itens[focoAtual].click();
        }
    }
    else if (e.key === "Tab") { 
        // Nota: No TAB geralmente não usamos preventDefault 
        // porque queremos que ele vá pro próximo campo se não tiver nada selecionado
         if (focoAtual > -1) {
             e.preventDefault(); // Aqui travamos o Tab só para preencher o campo primeiro
             if (itens) itens[focoAtual].click();
             // Opcional: Se quiser que ele preencha E mude de campo, teria que focar o próximo elemento manualmente.
             // Por enquanto, apenas preencher é mais seguro.
        } else {
            lista.style.display = 'none';
        }
    }
});

// --- 6. FUNÇÕES AUXILIARES (A Mágica da Cor) ---

function addAtivo(itens) {
    // 1. Limpa a cor de todos primeiro (pra não ficar dois azuis)
    removeAtivo(itens);

    // 2. Verifica se não saiu do limite da lista
    if (focoAtual >= itens.length) focoAtual = 0; // Se passou do último, volta pro primeiro
    if (focoAtual < 0) focoAtual = itens.length - 1; // Se subiu além do primeiro, vai pro último

    // 3. Adiciona a classe CSS que deixa azul
    itens[focoAtual].classList.add("item-selecionado");
    
    // (Opcional) Faz a lista rolar sozinha para acompanhar o item azul
    itens[focoAtual].scrollIntoView({ block: 'nearest' }); 
}

function removeAtivo(itens) {
    // Passa por todos os itens e tira a classe azul
    for (let i = 0; i < itens.length; i++) {
        itens[i].classList.remove("item-selecionado");
    }
}

// Fechar ao clicar fora
document.addEventListener('click', function(e) {
    if (e.target !== input) {
        lista.style.display = 'none';
    }
});
    </script>
    </body>
</html>